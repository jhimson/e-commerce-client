{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\Development\\\\A-portfolio-projects\\\\e-commerce-practice\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Development\\\\A-portfolio-projects\\\\e-commerce-practice\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Development\\\\A-portfolio-projects\\\\e-commerce-practice\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";/* eslint-disable no-nested-ternary */ /* eslint-disable camelcase */import React,{useEffect,useState}from'react';import Axios from'axios';import Moment from'moment';import{PayPalButton}from'react-paypal-button-v2';import{Link,useHistory,useParams}from'react-router-dom';import{Row,Col,ListGroup,Image,Card,Button}from'react-bootstrap';import{useDispatch,useSelector}from'react-redux';import{FaDollarSign}from'react-icons/fa';import Message from'../Message';import Loader from'../Loader';import{payOrder,getAllOrderedItemsByOrderId,deliverOrder,resetDeliverOrder}from'../../actions/orderActions';import{resetProductDetails}from'../../actions/productActions';import{orderConstants}from'../../constants/orderConstants';var OrderScreen=function OrderScreen(){var ORDER_PAY_RESET=orderConstants.ORDER_PAY_RESET;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),sdkReady=_useState2[0],setSdkReady=_useState2[1];var history=useHistory();var dispatch=useDispatch();var _useParams=useParams(),id=_useParams.id;var _useSelector=useSelector(function(state){return state.userLogin;}),userInfo=_useSelector.userInfo;var user_id=userInfo.user_id,email=userInfo.email,isAdmin=userInfo.isAdmin;var _useSelector2=useSelector(function(state){return state.orderedItems;}),orders=_useSelector2.orders,shippingDetails=_useSelector2.shippingDetails,loading=_useSelector2.loading,error=_useSelector2.error;var _useSelector3=useSelector(function(state){return state.orderPay;}),loadingPay=_useSelector3.loading,successPay=_useSelector3.success;var _useSelector4=useSelector(function(state){return state.orderDeliver;}),loadingDeliver=_useSelector4.loading,successDeliver=_useSelector4.success,errorDeliver=_useSelector4.error;// TODO - CALCULATIONS FOR PRICE\nvar addDecimals=function addDecimals(num){return(Math.round(num*100)/100).toFixed(2);};var subTotalPrice=addDecimals(orders.reduce(function(accu,item){return accu+parseInt(item.price)*item.quantity;},0));var shippingPrice=addDecimals(subTotalPrice>100?0:100);var taxPrice=addDecimals(Number((0.15*subTotalPrice).toFixed(2)));var totalPrice=(Number(subTotalPrice)+Number(shippingPrice)+Number(taxPrice)).toFixed(2);useEffect(function(){if(!email){history.push('/login');}dispatch(resetProductDetails());var addPayPalScript=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Axios$get,clientID,script;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Axios.get('https://raboy-eshop.herokuapp.com/api/v1/config/paypal');case 2:_yield$Axios$get=_context.sent;clientID=_yield$Axios$get.data;script=document.createElement('script');script.type='text/javascript';script.async=true;script.src=\"https://www.paypal.com/sdk/js?client-id=\".concat(clientID);script.onload=function(){setSdkReady(true);};document.body.appendChild(script);case 10:case\"end\":return _context.stop();}}},_callee);}));return function addPayPalScript(){return _ref.apply(this,arguments);};}();if(orders.length===0||successPay||successDeliver){dispatch({type:ORDER_PAY_RESET});dispatch(resetDeliverOrder());dispatch(getAllOrderedItemsByOrderId(id));}else if(!shippingDetails.is_paid){if(!window.paypal){addPayPalScript();}else{setSdkReady(true);}}},[dispatch,id,orders,shippingDetails.is_paid,successPay,successDeliver,ORDER_PAY_RESET,email,history,user_id]);var successPaymentHandler=function successPaymentHandler(paymentResult){dispatch(payOrder(shippingDetails.order_id,paymentResult));localStorage.removeItem('orderDetailsList');};return/*#__PURE__*/React.createElement(React.Fragment,null,loadingDeliver&&/*#__PURE__*/React.createElement(Loader,null),errorDeliver&&/*#__PURE__*/React.createElement(Message,{variant:\"danger\"},errorDeliver),error?/*#__PURE__*/React.createElement(Message,{variant:\"danger\"},\"\".concat(error)):loading?/*#__PURE__*/React.createElement(Loader,null):/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,{md:8},/*#__PURE__*/React.createElement(Message,{variant:\"info\"},/*#__PURE__*/React.createElement(\"h5\",null,\"ORDER \",id)),/*#__PURE__*/React.createElement(ListGroup,{variant:\"flush\"},/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(\"h2\",null,\"Shipping\"),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Name:\"),shippingDetails.name),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Email:\"),/*#__PURE__*/React.createElement(\"a\",{href:\"mailto:\".concat(shippingDetails.payment_email_address)},\"shippingDetails.payment_email_address\")),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Address:\"),shippingDetails.address,\",\",shippingDetails.city,' ',shippingDetails.postalCode,\" \",shippingDetails.country),shippingDetails.is_delivered?/*#__PURE__*/React.createElement(Message,{variant:\"success\"},\"Delivered on \".concat(Moment(shippingDetails.delivered_at).format('MMMM Do YYYY, h:mm:ss A'),\" - (\").concat(Moment().startOf('hour').fromNow(),\")\")):/*#__PURE__*/React.createElement(Message,{variant:\"danger\"},\"Not Delivered\")),/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(\"h2\",null,\"Payment Method\"),/*#__PURE__*/React.createElement(\"strong\",null,\"Method:\"),shippingDetails.payment_method,shippingDetails.is_paid?/*#__PURE__*/React.createElement(Message,{variant:\"success\"},\"Paid on \".concat(Moment(shippingDetails.paid_at).format('MMMM Do YYYY, h:mm:ss A'),\" - (\").concat(Moment().startOf('hour').fromNow(),\")\")):/*#__PURE__*/React.createElement(Message,{variant:\"danger\"},\"Not Paid\")),/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(\"h2\",null,\"Order List\"),orders.length===0?/*#__PURE__*/React.createElement(Message,null,\"No items found!\"):/*#__PURE__*/React.createElement(ListGroup,{variant:\"flush\"},orders.map(function(item){return/*#__PURE__*/React.createElement(ListGroup.Item,{key:item.product},/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,{md:1},/*#__PURE__*/React.createElement(Image,{src:item.image,alt:item.name,fluid:true,rounded:true})),/*#__PURE__*/React.createElement(Col,null,/*#__PURE__*/React.createElement(Link,{to:\"/product/\".concat(item.product_id)},item.name)),/*#__PURE__*/React.createElement(Col,{md:4},item.quantity,\" x \",/*#__PURE__*/React.createElement(FaDollarSign,null),item.price,\" = \",/*#__PURE__*/React.createElement(FaDollarSign,null),item.quantity*item.price)));}))))),/*#__PURE__*/React.createElement(Col,{md:4},/*#__PURE__*/React.createElement(Card,null,/*#__PURE__*/React.createElement(ListGroup,{variant:\"flush\"},/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(\"h2\",null,\"Order Summary\")),/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,null,\"Subtotal\"),/*#__PURE__*/React.createElement(Col,null,/*#__PURE__*/React.createElement(FaDollarSign,null),subTotalPrice))),/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,null,\"Shipping\"),/*#__PURE__*/React.createElement(Col,null,/*#__PURE__*/React.createElement(FaDollarSign,null),shippingPrice))),/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,null,\"Tax\"),/*#__PURE__*/React.createElement(Col,null,/*#__PURE__*/React.createElement(FaDollarSign,null),taxPrice))),/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,null,\"Total\"),/*#__PURE__*/React.createElement(Col,null,/*#__PURE__*/React.createElement(FaDollarSign,null),totalPrice))),!shippingDetails.is_paid&&/*#__PURE__*/React.createElement(ListGroup.Item,null,loadingPay&&/*#__PURE__*/React.createElement(Loader,null),!sdkReady?/*#__PURE__*/React.createElement(Loader,null):/*#__PURE__*/React.createElement(PayPalButton,{amount:totalPrice,onSuccess:successPaymentHandler})),userInfo&&isAdmin&&shippingDetails.is_paid&&!shippingDetails.is_delivered?/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(Button,{className:\"btn btn-block\",onClick:function onClick(){return dispatch(deliverOrder(id));}},\"Mark as Delivered\")):null)))));};export default OrderScreen;","map":{"version":3,"sources":["D:/Development/A-portfolio-projects/e-commerce-practice/frontend/src/components/screens/OrderScreen.jsx"],"names":["React","useEffect","useState","Axios","Moment","PayPalButton","Link","useHistory","useParams","Row","Col","ListGroup","Image","Card","Button","useDispatch","useSelector","FaDollarSign","Message","Loader","payOrder","getAllOrderedItemsByOrderId","deliverOrder","resetDeliverOrder","resetProductDetails","orderConstants","OrderScreen","ORDER_PAY_RESET","sdkReady","setSdkReady","history","dispatch","id","state","userLogin","userInfo","user_id","email","isAdmin","orderedItems","orders","shippingDetails","loading","error","orderPay","loadingPay","successPay","success","orderDeliver","loadingDeliver","successDeliver","errorDeliver","addDecimals","num","Math","round","toFixed","subTotalPrice","reduce","accu","item","parseInt","price","quantity","shippingPrice","taxPrice","Number","totalPrice","push","addPayPalScript","get","clientID","data","script","document","createElement","type","async","src","onload","body","appendChild","length","is_paid","window","paypal","successPaymentHandler","paymentResult","order_id","localStorage","removeItem","name","payment_email_address","address","city","postalCode","country","is_delivered","delivered_at","format","startOf","fromNow","payment_method","paid_at","map","product","image","product_id"],"mappings":"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","sourcesContent":["/* eslint-disable no-nested-ternary */\r\n/* eslint-disable camelcase */\r\nimport React, { useEffect, useState } from 'react';\r\nimport Axios from 'axios';\r\nimport Moment from 'moment';\r\nimport { PayPalButton } from 'react-paypal-button-v2';\r\nimport { Link, useHistory, useParams } from 'react-router-dom';\r\nimport { Row, Col, ListGroup, Image, Card, Button } from 'react-bootstrap';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { FaDollarSign } from 'react-icons/fa';\r\nimport Message from '../Message';\r\nimport Loader from '../Loader';\r\nimport {\r\n  payOrder,\r\n  getAllOrderedItemsByOrderId,\r\n  deliverOrder,\r\n  resetDeliverOrder,\r\n} from '../../actions/orderActions';\r\n\r\nimport { resetProductDetails } from '../../actions/productActions';\r\nimport { orderConstants } from '../../constants/orderConstants';\r\n\r\nconst OrderScreen = () => {\r\n  const { ORDER_PAY_RESET } = orderConstants;\r\n  const [sdkReady, setSdkReady] = useState(false);\r\n\r\n  const history = useHistory();\r\n  const dispatch = useDispatch();\r\n  const { id } = useParams();\r\n\r\n  const { userInfo } = useSelector((state) => state.userLogin);\r\n  const { user_id, email, isAdmin } = userInfo;\r\n\r\n  const { orders, shippingDetails, loading, error } = useSelector(\r\n    (state) => state.orderedItems\r\n  );\r\n\r\n  const { loading: loadingPay, success: successPay } = useSelector(\r\n    (state) => state.orderPay\r\n  );\r\n\r\n  const {\r\n    loading: loadingDeliver,\r\n    success: successDeliver,\r\n    error: errorDeliver,\r\n  } = useSelector((state) => state.orderDeliver);\r\n\r\n  // TODO - CALCULATIONS FOR PRICE\r\n  const addDecimals = (num) => (Math.round(num * 100) / 100).toFixed(2);\r\n  const subTotalPrice = addDecimals(\r\n    orders.reduce(\r\n      (accu, item) => accu + parseInt(item.price) * item.quantity,\r\n      0\r\n    )\r\n  );\r\n  const shippingPrice = addDecimals(subTotalPrice > 100 ? 0 : 100);\r\n  const taxPrice = addDecimals(Number((0.15 * subTotalPrice).toFixed(2)));\r\n\r\n  const totalPrice = (\r\n    Number(subTotalPrice) +\r\n    Number(shippingPrice) +\r\n    Number(taxPrice)\r\n  ).toFixed(2);\r\n\r\n  useEffect(() => {\r\n    if (!email) {\r\n      history.push('/login');\r\n    }\r\n    dispatch(resetProductDetails());\r\n    const addPayPalScript = async () => {\r\n      const { data: clientID } = await Axios.get(\r\n        'https://raboy-eshop.herokuapp.com/api/v1/config/paypal'\r\n      );\r\n      const script = document.createElement('script');\r\n      script.type = 'text/javascript';\r\n      script.async = true;\r\n      script.src = `https://www.paypal.com/sdk/js?client-id=${clientID}`;\r\n      script.onload = () => {\r\n        setSdkReady(true);\r\n      };\r\n      document.body.appendChild(script);\r\n    };\r\n\r\n    if (orders.length === 0 || successPay || successDeliver) {\r\n      dispatch({ type: ORDER_PAY_RESET });\r\n      dispatch(resetDeliverOrder());\r\n      dispatch(getAllOrderedItemsByOrderId(id));\r\n    } else if (!shippingDetails.is_paid) {\r\n      if (!window.paypal) {\r\n        addPayPalScript();\r\n      } else {\r\n        setSdkReady(true);\r\n      }\r\n    }\r\n  }, [\r\n    dispatch,\r\n    id,\r\n    orders,\r\n    shippingDetails.is_paid,\r\n    successPay,\r\n    successDeliver,\r\n    ORDER_PAY_RESET,\r\n    email,\r\n    history,\r\n    user_id,\r\n  ]);\r\n\r\n  const successPaymentHandler = (paymentResult) => {\r\n    dispatch(payOrder(shippingDetails.order_id, paymentResult));\r\n    localStorage.removeItem('orderDetailsList');\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {loadingDeliver && <Loader />}\r\n      {errorDeliver && <Message variant=\"danger\">{errorDeliver}</Message>}\r\n      {error ? (\r\n        <Message variant=\"danger\">{`${error}`}</Message>\r\n      ) : loading ? (\r\n        <Loader />\r\n      ) : (\r\n        <Row>\r\n          <Col md={8}>\r\n            <Message variant=\"info\">\r\n              <h5>ORDER {id}</h5>\r\n            </Message>\r\n            <ListGroup variant=\"flush\">\r\n              <ListGroup.Item>\r\n                <h2>Shipping</h2>\r\n                <p>\r\n                  <strong>Name:</strong>\r\n                  {shippingDetails.name}\r\n                </p>\r\n                <p>\r\n                  <strong>Email:</strong>\r\n                  <a href={`mailto:${shippingDetails.payment_email_address}`}>\r\n                    shippingDetails.payment_email_address\r\n                  </a>\r\n                </p>\r\n                <p>\r\n                  <strong>Address:</strong>\r\n                  {shippingDetails.address},{shippingDetails.city}{' '}\r\n                  {shippingDetails.postalCode} {shippingDetails.country}\r\n                </p>\r\n                {shippingDetails.is_delivered ? (\r\n                  <Message variant=\"success\">{`Delivered on ${Moment(\r\n                    shippingDetails.delivered_at\r\n                  ).format('MMMM Do YYYY, h:mm:ss A')} - (${Moment()\r\n                    .startOf('hour')\r\n                    .fromNow()})`}</Message>\r\n                ) : (\r\n                  <Message variant=\"danger\">Not Delivered</Message>\r\n                )}\r\n              </ListGroup.Item>\r\n              <ListGroup.Item>\r\n                <h2>Payment Method</h2>\r\n                <strong>Method:</strong>\r\n                {shippingDetails.payment_method}\r\n                {shippingDetails.is_paid ? (\r\n                  <Message variant=\"success\">\r\n                    {`Paid on ${Moment(shippingDetails.paid_at).format(\r\n                      'MMMM Do YYYY, h:mm:ss A'\r\n                    )} - (${Moment().startOf('hour').fromNow()})`}\r\n                  </Message>\r\n                ) : (\r\n                  <Message variant=\"danger\">Not Paid</Message>\r\n                )}\r\n              </ListGroup.Item>\r\n              <ListGroup.Item>\r\n                <h2>Order List</h2>\r\n\r\n                {orders.length === 0 ? (\r\n                  <Message>No items found!</Message>\r\n                ) : (\r\n                  <ListGroup variant=\"flush\">\r\n                    {orders.map((item) => (\r\n                      <ListGroup.Item key={item.product}>\r\n                        <Row>\r\n                          <Col md={1}>\r\n                            <Image\r\n                              src={item.image}\r\n                              alt={item.name}\r\n                              fluid\r\n                              rounded\r\n                            />\r\n                          </Col>\r\n                          <Col>\r\n                            <Link to={`/product/${item.product_id}`}>\r\n                              {item.name}\r\n                            </Link>\r\n                          </Col>\r\n                          <Col md={4}>\r\n                            {item.quantity} x <FaDollarSign />\r\n                            {item.price} = <FaDollarSign />\r\n                            {item.quantity * item.price}\r\n                          </Col>\r\n                        </Row>\r\n                      </ListGroup.Item>\r\n                    ))}\r\n                  </ListGroup>\r\n                )}\r\n              </ListGroup.Item>\r\n            </ListGroup>\r\n          </Col>\r\n          <Col md={4}>\r\n            <Card>\r\n              <ListGroup variant=\"flush\">\r\n                <ListGroup.Item>\r\n                  <h2>Order Summary</h2>\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <Row>\r\n                    <Col>Subtotal</Col>\r\n                    <Col>\r\n                      <FaDollarSign />\r\n                      {subTotalPrice}\r\n                    </Col>\r\n                  </Row>\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <Row>\r\n                    <Col>Shipping</Col>\r\n                    <Col>\r\n                      <FaDollarSign />\r\n                      {shippingPrice}\r\n                    </Col>\r\n                  </Row>\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <Row>\r\n                    <Col>Tax</Col>\r\n                    <Col>\r\n                      <FaDollarSign />\r\n                      {taxPrice}\r\n                    </Col>\r\n                  </Row>\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <Row>\r\n                    <Col>Total</Col>\r\n                    <Col>\r\n                      <FaDollarSign />\r\n                      {totalPrice}\r\n                    </Col>\r\n                  </Row>\r\n                </ListGroup.Item>\r\n                {!shippingDetails.is_paid && (\r\n                  <ListGroup.Item>\r\n                    {loadingPay && <Loader />}\r\n                    {!sdkReady ? (\r\n                      <Loader />\r\n                    ) : (\r\n                      <PayPalButton\r\n                        amount={totalPrice}\r\n                        onSuccess={successPaymentHandler}\r\n                      />\r\n                    )}\r\n                  </ListGroup.Item>\r\n                )}\r\n                {userInfo &&\r\n                isAdmin &&\r\n                shippingDetails.is_paid &&\r\n                !shippingDetails.is_delivered ? (\r\n                  <ListGroup.Item>\r\n                    <Button\r\n                      className=\"btn btn-block\"\r\n                      onClick={() => dispatch(deliverOrder(id))}\r\n                    >\r\n                      Mark as Delivered\r\n                    </Button>\r\n                  </ListGroup.Item>\r\n                ) : null}\r\n              </ListGroup>\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n      )}\r\n    </>\r\n  );\r\n};\r\nexport default OrderScreen;\r\n"]},"metadata":{},"sourceType":"module"}