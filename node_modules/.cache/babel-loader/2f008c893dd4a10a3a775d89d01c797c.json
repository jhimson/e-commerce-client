{"ast":null,"code":"import _toConsumableArray from\"D:\\\\Development\\\\A-portfolio-projects\\\\e-commerce-practice\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:\\\\Development\\\\A-portfolio-projects\\\\e-commerce-practice\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useHistory}from'react-router-dom';import{Form,Button,Row,Col,Table}from'react-bootstrap';import{LinkContainer}from'react-router-bootstrap';import{useDispatch,useSelector}from'react-redux';import{FcCancel}from'react-icons/fc';import moment from'moment';import Message from'../Message';import Loader from'../Loader';import{getUserDetails,updateUserProfile}from'../../actions/userActions';import{getOrdersByUserId,getOrdersByOrderId,getAllOrderedItemsByOrderId}from'../../actions/orderActions';var ProfileScreen=function ProfileScreen(){var history=useHistory();var dispatch=useDispatch();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),firstname=_useState4[0],setFirstname=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),lastname=_useState6[0],setLastname=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),username=_useState8[0],setUsername=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),password=_useState10[0],setPassword=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),confirmPassword=_useState12[0],setConfirmPassword=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),message=_useState14[0],setMessage=_useState14[1];var _useState15=useState('danger'),_useState16=_slicedToArray(_useState15,2),variant=_useState16[0],setVariant=_useState16[1];var currentUser=useSelector(function(state){return state.userDetails;});var loading=currentUser.loading,error=currentUser.error,user=currentUser.user;var userInfo=useSelector(function(state){return state.userLogin.userInfo;});var _useSelector=useSelector(function(state){return state.orderFetch;}),orderItems=_useSelector.orderItems;var orderDetails=useSelector(function(state){return state.orderDetails;});var uniqueOrderId=[];useEffect(function(){if(!userInfo){history.push('/login');}if(user===null||JSON.stringify(user)==='{}'){dispatch(getUserDetails('profile'));dispatch(getOrdersByUserId(userInfo.user_id));}else{setFirstname(user.firstname);setLastname(user.lastname);setEmail(user.email);setUsername(user.username);dispatch(getOrdersByUserId(userInfo.user_id));}if(orderItems){orderItems.forEach(function(order){if(!uniqueOrderId.includes(order.order_id)){uniqueOrderId=[].concat(_toConsumableArray(uniqueOrderId),[order.order_id]);}});uniqueOrderId.forEach(function(id){dispatch(getOrdersByOrderId(id));});}},[dispatch,history,userInfo,user]);var submitHandler=function submitHandler(e){e.preventDefault();if(password!==confirmPassword){setVariant('danger');setMessage('Passwords do not match');}else{//* DISPATCH UPDATE PROFILE\ndispatch(updateUserProfile(email,firstname,lastname,username,password));setVariant('success');setMessage('Profile Updated');setPassword('');setConfirmPassword('');}};return/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,{md:3},/*#__PURE__*/React.createElement(\"h2\",null,\"User Profile\"),message&&/*#__PURE__*/React.createElement(Message,{variant:variant},message),error&&/*#__PURE__*/React.createElement(Message,{variant:\"danger\"},error),loading&&/*#__PURE__*/React.createElement(Loader,null),/*#__PURE__*/React.createElement(Form,{onSubmit:submitHandler},/*#__PURE__*/React.createElement(Form.Group,{controlId:\"firstname\"},/*#__PURE__*/React.createElement(Form.Label,null,\"Firstname\"),/*#__PURE__*/React.createElement(Form.Control,{type:\"text\",placeholder:\"Enter Firstname\",value:firstname,onChange:function onChange(e){return setFirstname(e.target.value);},required:true})),/*#__PURE__*/React.createElement(Form.Group,{controlId:\"lastname\"},/*#__PURE__*/React.createElement(Form.Label,null,\"Lastname\"),/*#__PURE__*/React.createElement(Form.Control,{type:\"text\",placeholder:\"Enter Lastname\",value:lastname,onChange:function onChange(e){return setLastname(e.target.value);},required:true})),/*#__PURE__*/React.createElement(Form.Group,{controlId:\"email\"},/*#__PURE__*/React.createElement(Form.Label,null,\"Email\"),/*#__PURE__*/React.createElement(Form.Control,{type:\"email\",placeholder:\"Enter Email\",value:email,onChange:function onChange(e){return setEmail(e.target.value);},required:true})),/*#__PURE__*/React.createElement(Form.Group,{controlId:\"username\"},/*#__PURE__*/React.createElement(Form.Label,null,\"Username\"),/*#__PURE__*/React.createElement(Form.Control,{type:\"text\",placeholder:\"Enter Username\",value:username,onChange:function onChange(e){return setUsername(e.target.value);},required:true})),/*#__PURE__*/React.createElement(Form.Group,{controlId:\"password\"},/*#__PURE__*/React.createElement(Form.Label,null,\"Password\"),/*#__PURE__*/React.createElement(Form.Control,{type:\"password\",placeholder:\"Enter Password\",value:password,onChange:function onChange(e){return setPassword(e.target.value);}})),/*#__PURE__*/React.createElement(Form.Group,{controlId:\"confimPassword\"},/*#__PURE__*/React.createElement(Form.Label,null,\"Confirm Password\"),/*#__PURE__*/React.createElement(Form.Control,{type:\"password\",placeholder:\"Confirm Password\",value:confirmPassword,onChange:function onChange(e){return setConfirmPassword(e.target.value);}})),/*#__PURE__*/React.createElement(Button,{className:\"btn-block\",type:\"submit\",variance:\"primary\"},\"Update\"))),/*#__PURE__*/React.createElement(Col,{md:9},/*#__PURE__*/React.createElement(\"h2\",null,\"My Orders\"),/*#__PURE__*/React.createElement(Table,{striped:true,bordered:true,hover:true,responsive:true},/*#__PURE__*/React.createElement(\"thead\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"th\",null,\"ORDER CODE\"),/*#__PURE__*/React.createElement(\"th\",null,\"Date\"),/*#__PURE__*/React.createElement(\"th\",null,\"total\"),/*#__PURE__*/React.createElement(\"th\",null,\"Paid\"),/*#__PURE__*/React.createElement(\"th\",null,\"Delivered\"),/*#__PURE__*/React.createElement(\"th\",null,\"information\"))),/*#__PURE__*/React.createElement(\"tbody\",null,orderDetails.loading&&/*#__PURE__*/React.createElement(Loader,null),orderDetails.orderDetailsList?orderDetails.orderDetailsList.map(function(order){return/*#__PURE__*/React.createElement(\"tr\",{key:order.order_id},/*#__PURE__*/React.createElement(\"td\",null,order.order_id),/*#__PURE__*/React.createElement(\"td\",null,moment(order.created_at).format('MMM Do YYYY, h:mm:ss A')),/*#__PURE__*/React.createElement(\"td\",null,Number(order.subtotal)),/*#__PURE__*/React.createElement(\"td\",null,order.paid_at===null?/*#__PURE__*/React.createElement(FcCancel,{size:\"2em\"}):moment(order.paid_at).format('MMM Do YYYY')),/*#__PURE__*/React.createElement(\"td\",null,order.delivered_at===null?/*#__PURE__*/React.createElement(FcCancel,{size:\"2em\"}):moment(order.delivered_at).format('MMM Do YYYY, h:mm:ss A')),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(LinkContainer,{to:\"/order/\".concat(order.order_id)},/*#__PURE__*/React.createElement(Button,{className:\"btn-sm\",type:\"submit\",variant:\"dark\",onClick:function onClick(){dispatch(getAllOrderedItemsByOrderId(order.order_id));}},\"details\"))));}):/*#__PURE__*/React.createElement(\"h2\",null,\"No Orders found!\")))));};export default ProfileScreen;","map":{"version":3,"sources":["D:/Development/A-portfolio-projects/e-commerce-practice/frontend/src/components/screens/ProfileScreen.jsx"],"names":["React","useState","useEffect","useHistory","Form","Button","Row","Col","Table","LinkContainer","useDispatch","useSelector","FcCancel","moment","Message","Loader","getUserDetails","updateUserProfile","getOrdersByUserId","getOrdersByOrderId","getAllOrderedItemsByOrderId","ProfileScreen","history","dispatch","email","setEmail","firstname","setFirstname","lastname","setLastname","username","setUsername","password","setPassword","confirmPassword","setConfirmPassword","message","setMessage","variant","setVariant","currentUser","state","userDetails","loading","error","user","userInfo","userLogin","orderFetch","orderItems","orderDetails","uniqueOrderId","push","JSON","stringify","user_id","forEach","order","includes","order_id","id","submitHandler","e","preventDefault","target","value","orderDetailsList","map","created_at","format","Number","subtotal","paid_at","delivered_at"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport { Form, Button, Row, Col, Table } from 'react-bootstrap';\r\nimport { LinkContainer } from 'react-router-bootstrap';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { FcCancel } from 'react-icons/fc';\r\nimport moment from 'moment';\r\nimport Message from '../Message';\r\nimport Loader from '../Loader';\r\nimport { getUserDetails, updateUserProfile } from '../../actions/userActions';\r\nimport {\r\n  getOrdersByUserId,\r\n  getOrdersByOrderId,\r\n  getAllOrderedItemsByOrderId,\r\n} from '../../actions/orderActions';\r\n\r\nconst ProfileScreen = () => {\r\n  const history = useHistory();\r\n  const dispatch = useDispatch();\r\n  const [email, setEmail] = useState('');\r\n  const [firstname, setFirstname] = useState('');\r\n  const [lastname, setLastname] = useState('');\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [confirmPassword, setConfirmPassword] = useState('');\r\n  const [message, setMessage] = useState(null);\r\n  const [variant, setVariant] = useState('danger');\r\n\r\n  const currentUser = useSelector((state) => state.userDetails);\r\n  const { loading, error, user } = currentUser;\r\n  const userInfo = useSelector((state) => state.userLogin.userInfo);\r\n  const { orderItems } = useSelector((state) => state.orderFetch);\r\n\r\n  const orderDetails = useSelector((state) => state.orderDetails);\r\n\r\n  let uniqueOrderId = [];\r\n\r\n  useEffect(() => {\r\n    if (!userInfo) {\r\n      history.push('/login');\r\n    }\r\n    if (user === null || JSON.stringify(user) === '{}') {\r\n      dispatch(getUserDetails('profile'));\r\n      dispatch(getOrdersByUserId(userInfo.user_id));\r\n    } else {\r\n      setFirstname(user.firstname);\r\n      setLastname(user.lastname);\r\n      setEmail(user.email);\r\n      setUsername(user.username);\r\n      dispatch(getOrdersByUserId(userInfo.user_id));\r\n    }\r\n    if (orderItems) {\r\n      orderItems.forEach((order) => {\r\n        if (!uniqueOrderId.includes(order.order_id)) {\r\n          uniqueOrderId = [...uniqueOrderId, order.order_id];\r\n        }\r\n      });\r\n\r\n      uniqueOrderId.forEach((id) => {\r\n        dispatch(getOrdersByOrderId(id));\r\n      });\r\n    }\r\n  }, [dispatch, history, userInfo, user]);\r\n\r\n  const submitHandler = (e) => {\r\n    e.preventDefault();\r\n    if (password !== confirmPassword) {\r\n      setVariant('danger');\r\n      setMessage('Passwords do not match');\r\n    } else {\r\n      //* DISPATCH UPDATE PROFILE\r\n      dispatch(\r\n        updateUserProfile(email, firstname, lastname, username, password)\r\n      );\r\n      setVariant('success');\r\n      setMessage('Profile Updated');\r\n      setPassword('');\r\n      setConfirmPassword('');\r\n    }\r\n  };\r\n  return (\r\n    <Row>\r\n      <Col md={3}>\r\n        <h2>User Profile</h2>\r\n        {message && <Message variant={variant}>{message}</Message>}\r\n        {error && <Message variant=\"danger\">{error}</Message>}\r\n        {loading && <Loader />}\r\n        <Form onSubmit={submitHandler}>\r\n          <Form.Group controlId=\"firstname\">\r\n            <Form.Label>Firstname</Form.Label>\r\n            <Form.Control\r\n              type=\"text\"\r\n              placeholder=\"Enter Firstname\"\r\n              value={firstname}\r\n              onChange={(e) => setFirstname(e.target.value)}\r\n              required\r\n            />\r\n          </Form.Group>\r\n          <Form.Group controlId=\"lastname\">\r\n            <Form.Label>Lastname</Form.Label>\r\n            <Form.Control\r\n              type=\"text\"\r\n              placeholder=\"Enter Lastname\"\r\n              value={lastname}\r\n              onChange={(e) => setLastname(e.target.value)}\r\n              required\r\n            />\r\n          </Form.Group>\r\n          <Form.Group controlId=\"email\">\r\n            <Form.Label>Email</Form.Label>\r\n            <Form.Control\r\n              type=\"email\"\r\n              placeholder=\"Enter Email\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              required\r\n            />\r\n          </Form.Group>\r\n          <Form.Group controlId=\"username\">\r\n            <Form.Label>Username</Form.Label>\r\n            <Form.Control\r\n              type=\"text\"\r\n              placeholder=\"Enter Username\"\r\n              value={username}\r\n              onChange={(e) => setUsername(e.target.value)}\r\n              required\r\n            />\r\n          </Form.Group>\r\n          <Form.Group controlId=\"password\">\r\n            <Form.Label>Password</Form.Label>\r\n            <Form.Control\r\n              type=\"password\"\r\n              placeholder=\"Enter Password\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n            />\r\n          </Form.Group>\r\n          <Form.Group controlId=\"confimPassword\">\r\n            <Form.Label>Confirm Password</Form.Label>\r\n            <Form.Control\r\n              type=\"password\"\r\n              placeholder=\"Confirm Password\"\r\n              value={confirmPassword}\r\n              onChange={(e) => setConfirmPassword(e.target.value)}\r\n            />\r\n          </Form.Group>\r\n          <Button className=\"btn-block\" type=\"submit\" variance=\"primary\">\r\n            Update\r\n          </Button>\r\n        </Form>\r\n      </Col>\r\n      <Col md={9}>\r\n        <h2>My Orders</h2>\r\n        <Table striped bordered hover responsive>\r\n          <thead>\r\n            <tr>\r\n              <th>ORDER CODE</th>\r\n              <th>Date</th>\r\n              <th>total</th>\r\n              <th>Paid</th>\r\n              <th>Delivered</th>\r\n              <th>information</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {orderDetails.loading && <Loader />}\r\n            {orderDetails.orderDetailsList ? (\r\n              orderDetails.orderDetailsList.map((order) => (\r\n                <tr key={order.order_id}>\r\n                  <td>{order.order_id}</td>\r\n                  <td>\r\n                    {moment(order.created_at).format('MMM Do YYYY, h:mm:ss A')}\r\n                  </td>\r\n                  <td>{Number(order.subtotal)}</td>\r\n                  <td>\r\n                    {order.paid_at === null ? (\r\n                      <FcCancel size=\"2em\" />\r\n                    ) : (\r\n                      moment(order.paid_at).format('MMM Do YYYY')\r\n                    )}\r\n                  </td>\r\n                  <td>\r\n                    {order.delivered_at === null ? (\r\n                      <FcCancel size=\"2em\" />\r\n                    ) : (\r\n                      moment(order.delivered_at).format(\r\n                        'MMM Do YYYY, h:mm:ss A'\r\n                      )\r\n                    )}\r\n                  </td>\r\n                  <td>\r\n                    <LinkContainer to={`/order/${order.order_id}`}>\r\n                      <Button\r\n                        className=\"btn-sm\"\r\n                        type=\"submit\"\r\n                        variant=\"dark\"\r\n                        onClick={() => {\r\n                          dispatch(getAllOrderedItemsByOrderId(order.order_id));\r\n                        }}\r\n                      >\r\n                        details\r\n                      </Button>\r\n                    </LinkContainer>\r\n                  </td>\r\n                </tr>\r\n              ))\r\n            ) : (\r\n              <h2>No Orders found!</h2>\r\n            )}\r\n          </tbody>\r\n        </Table>\r\n      </Col>\r\n    </Row>\r\n  );\r\n};\r\nexport default ProfileScreen;\r\n"]},"metadata":{},"sourceType":"module"}